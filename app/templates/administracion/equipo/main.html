<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="{{ url_for('static', filename='../static/images/Logo-uexternado.png') }}">
    <link rel="stylesheet" href="{{url_for('static',filename='../static/dist/css/output.css')}}">
    <script src="https://kit.fontawesome.com/175f4319ea.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="{{url_for('static', filename='../static/dist/js/numpad.js')}}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <title>Document</title>
</head>

<body class="fondo bg-cover bg-no-repeat">
    <header class="flex row bg-white max-h-32 justify-between items-center">
        <img src="{{url_for('static',filename='../static/images/logo-uec.png')}}" alt=""
            class="object-contain w-1/6 aspect-3/2 mx-4">
            <button onclick="reload()" class="text-green-900 m-16 text-2xl font-semibold p-4 rounded-xl hover:text-green-800 hover:shadow-2xl">
                <i class="fa-solid fa-rotate-right mx-4" style="color: #14532d;"></i>Recargar Pagina
            </button>
        <div>
            <ul class="flex flex-row">
                <li>
                    <form action="{{ url_for('usuario.logout') }}" method="post">
                        <button class="text-green-900 m-16 text-2xl font-semibold p-4 rounded-xl hover:text-green-800 hover:shadow-2xl">
                            <i class="fa-solid fa-hand-point-left"></i> Salir
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </header>
    
    <div class="flex justify-between">
            <div class="equipos">
                <div class="izquierda">
                    <div class="box-left my-5 mx-5 grid gap-x-1 gap-y-1 grid-cols-1 w-1/3 justify-items-center">
                        {% for i in range(110, 100, -1) %}
                            {% for equipo in equipos %}
                            {% if equipo.idEquipo==i %}
                            {% if equipo.estadoEquipo == "usado" %}
                            <a style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right_usado" value="{{ i }}" name="action" onclick="equipoUsado({{ i }} )">
                                {{ i - 100  }}
                            </a>
                            {% else %}
                            <button  style="padding-bottom: 5px; padding-top: 5px" class="cta__right" value="{{ i }}" name="action" onclick="confirmarPrestamo({{ i }})">
                                {{ i - 100 }}
                            </button>
                            {% endif %}
                            {% endif %}
                            {% endfor %}
                        {% endfor %}
                        <div class="box-image">
                            <div class="flex flex-col justify-center w-1/3">
                                <h4 class="info_recep">¡Usted está aquí!</h4>
                                <img class="recepcion" src="{{ url_for('static', filename='../static/images/recepcion.png') }}" alt="Not Found">
                            </div>
                        </div>
                    </div>
                    <div class="box-mid-left my-5 mx-5 grid gap-x-1 gap-y-1 grid-cols-1 w-1/3 justify-items-center">
                        {% for i in range(111, 117,+1) %}
                            {% for equipo in equipos %}
                            {% if equipo.idEquipo==i %}
                            {% if equipo.estadoEquipo == "usado" %}
                            <a style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right_usado" value="{{ i }}" name="action" onclick="equipoUsado({{ i }} )">
                                {{ i - 100  }}
                            </a>
                            {% else %}
                            <button  style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right" value="{{ i }}" name="action" onclick="confirmarPrestamo({{ i }})">
                                {{ i - 100 }}
                            </button>
                            {% endif %}
                            {% endif %}
                            {% endfor %}
                        {% endfor %}

                        <!-- {% for i in range(8, 5,-1) %}
                            {% for equipo in equipos %}
                            {% if equipo.idEquipo==i %}
                            {% if equipo.estadoEquipo == "usado" %}
                            <a style="padding: 24.5px; padding-bottom: 18px; padding-top: 17px" class="cta__right_usado" value="{{ i }}" name="action" onclick="equipoUsado({{ i }})">
                                {% if i < 10 %} 0{{ i }} {% else %} {{ i }} {% endif %}  
                            </a>
                            {% else %}
                            <button  style="padding: 24.5px; padding-bottom: 18px; padding-top: 17px" class="cta__right" value="{{ i }}" name="action" onclick="confirmarPrestamo({{ i }})">
                                {% if i < 10 %} 0{{ i }} {% else %} {{ i }} {% endif %} 
                            </button>
                            {% endif %}
                            {% endif %}
                            {% endfor %}
                        {% endfor %} -->

                    </div>
                </div>
                <div class="derecha">
                    <div class="box-mid-right my-5 mx-5 grid gap-x-1 gap-y-1 grid-cols-1 w-1/3 justify-items-center">

                        {% for i in range(122, 116, -1) %}
                            {% for equipo in equipos %}
                            {% if equipo.idEquipo==i %}
                            {% if equipo.estadoEquipo == "usado" %}
                            <a style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right_usado" value="{{ i - 100 }}" name="action" onclick="equipoUsado({{ i - 100  }} )">
                                {{ i - 100  }}
                            </a>
                            {% else %}
                            <button  style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right" value="{{ i  }}" name="action" onclick="confirmarPrestamo({{ i - 100 }})">
                                {{ i - 100 }}
                            </button>
                            {% endif %}
                            {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>

                    <div class="box-right my-5 mx-5 grid gap-x-1 gap-y-1 grid-cols-1 w-1/3 justify-items-center">

                        {% for i in range(123, 135, +1) %}
                            {% for equipo in equipos %}
                            {% if equipo.idEquipo==i %}
                            {% if equipo.estadoEquipo == "usado" %}
                            <a style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right_usado" value="{{ i - 100 }}" name="action" onclick="equipoUsado({{ i - 100 }} )">
                                {{ i - 100  }}
                            </a>
                            {% else %}
                            <button  style="padding: 25px; padding-bottom: 15px; padding-top: 15px" class="cta__right" value="{{ i }}" name="action" onclick="confirmarPrestamo({{ i - 100 }})">
                                {{ i - 100 }}
                            </button>
                            {% endif %}
                            {% endif %}
                            {% endfor %}
                            {% endfor %}
                    </div>
                </div>
            </div>
            
        

        <div>
            <img class="mr-52" src="{{ url_for('static', filename='../static/images/main.png') }}" alt="Not Found">
        </div>


    </div>
    <script>
        function confirmarPrestamo(equipoId) {
            const softwares = {{ software|tojson }};
            
            // Función para abrir el SweetAlert
            const openModal = (softwareId = '0', otroSoftwareNombre = '') => {
                let selectHtml = '<select id="softwareSelect" name="software" class="swal2-select border-2 border-black rounded-lg" required><option value="0" selected disabled>Que Software usaras?</option>';
                softwares.forEach(software => {
                    selectHtml += `<option value="${software.idSoftware}" ${softwareId == software.idSoftware ? 'selected' : ''}>${software.nombreSoftware}</option>`;
                });
                selectHtml += '</select>';
                selectHtml += '<div id="otroSoftwareContainer" style="margin-top: 10px;"></div>';
        
                // Añadir el campo 'otroSoftware' si es necesario
                if (softwareId == '200') {
                    selectHtml += '<h2 class="swal2-title text-2xl">¿Cual? <br>(Orange, PowerBI, Internet, Office)</h2><input required="required" type="text" id="otroSoftware" class="swal2-input border-2 border-black" placeholder="Ingrese el nombre del software" value="' + otroSoftwareNombre + '">';
                }
        
                Swal.fire({
                    title: '¿Qué software usarás?',
                    text: "¿Deseas pedir el equipo " + equipoId + "?",
                    html: selectHtml,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Confirmar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const softwareId = document.getElementById('softwareSelect').value;
                        const otroSoftwareNombre = document.getElementById('otroSoftware') ? document.getElementById('otroSoftware').value : null;
            
                        // Validar el campo adicional y la selección
                        if (softwareId === '0') {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Por favor, debe seleccionar un software.',
                                confirmButtonColor: '#3085d6'
                            }).then(() => {
                                openModal(softwareId, otroSoftwareNombre); // Reabrir el modal
                            });
                            return; // Detener la ejecución
                        }
            
                        if (softwareId == '200' && (!otroSoftwareNombre || otroSoftwareNombre.trim() === '')) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error',
                                text: 'Por favor, ingrese el nombre del software adicional.',
                                confirmButtonColor: '#3085d6'
                            }).then(() => {
                                openModal(softwareId, otroSoftwareNombre); // Reabrir el modal
                            });
                            return; // Detener la ejecución
                        }
        
                        // Enviar la solicitud AJAX
                        $.ajax({
                            url: "{{ url_for('equipo.pedir_equipo') }}",
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                pc: equipoId,
                                softwareId: softwareId,
                                otroSoftware: otroSoftwareNombre // Si existe, enviar el nombre del software "otro"
                            }),
                            success: function (response) {
                                if (response.status === 'success') {
                                    Swal.fire({
                                        icon: 'success',
                                        title: 'Éxito',
                                        text: response.message,
                                        confirmButtonColor: '#3085d6'
                                    }).then(() => {
                                        window.location.href = "{{ url_for('usuario.login') }}";
                                    });
                                } else if (response.status === 'warning') {
                                    Swal.fire({
                                        icon: 'warning',
                                        title: 'Advertencia',
                                        text: response.message,
                                        confirmButtonColor: '#3085d6'
                                    });
                                } else if (response.status === 'error') {
                                    Swal.fire({
                                        icon: 'error',
                                        title: 'Error',
                                        text: response.message,
                                        confirmButtonColor: '#3085d6'
                                    });
                                }
                            },
                            error: function (jqXHR) {
                                console.error(jqXHR.responseText); // Imprime el mensaje de error para depuración
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'Ocurrió un error al procesar la solicitud.',
                                    confirmButtonColor: '#3085d6'
                                });
                            }
                        });
                    }
                });
            };
        
            // Llamar a la función para abrir el modal por primera vez
            openModal();
        
            // Agregar un event listener al select para detectar el cambio
            document.addEventListener('change', function (e) {
                if (e.target && e.target.id === 'softwareSelect') {
                    const selectedValue = e.target.value;
        
                    // Si el valor seleccionado es '200', añadir el campo de texto
                    if (selectedValue == '200') {
                        document.getElementById('otroSoftwareContainer').innerHTML = '<h2 class="swal2-title text-2xl">¿Cual? <br>(Orange, PowerBI, Internet, Office)</h2><input required="required" type="text" id="otroSoftware" class="swal2-input required" placeholder="Ingrese el nombre del software">';
                    } else {
                    // Si no, remover el campo de texto si existe
                        document.getElementById('otroSoftwareContainer').innerHTML = '';
                    }
                }
            });
        }
        
        
        function equipoUsado(equipoId){
            Swal.fire({
                title: '¡Equipo en uso!',
                text: "El equipo " + equipoId + " ya está en uso",
                icon: 'warning',
                showCancelButton: false,
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'Volver',
            });
        }
        
        function reload(){
            window.location.reload();
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        $("body").on("contextmenu", function (e) {
            return false;
        })
    </script>
</body>



</html>